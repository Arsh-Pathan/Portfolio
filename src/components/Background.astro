---

---

<canvas id="space-background"></canvas>

<script>
  import * as THREE from "three";

  const canvas = document.getElementById(
    "space-background",
  ) as HTMLCanvasElement;

  if (canvas) {
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(
      80,
      window.innerWidth / window.innerHeight,
      50,
      2000,
    );

    const renderer = new THREE.WebGLRenderer({
      canvas,
      alpha: true,
      antialias: true,
    });

    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

    /* ---------------- STARS ---------------- */

    const starsGeometry = new THREE.BufferGeometry();
    const starsMaterial = new THREE.PointsMaterial({
      color: 0xffffff,
      size: 3,
      sizeAttenuation: true,
      transparent: true,
      opacity: 0.8,
      vertexColors: true,
    });

    const starsCount = 3000;
    const positions = new Float32Array(starsCount * 3);
    const colors = new Float32Array(starsCount * 3);

    for (let i = 0; i < starsCount * 3; i += 3) {
      positions[i] = (Math.random() - 0.5) * 2000;
      positions[i + 1] = (Math.random() - 0.5) * 2000;
      positions[i + 2] = (Math.random() - 0.5) * 2000;

      const palette = [
        { r: 0.56, g: 0.64, b: 0.56 },
        { r: 0.36, g: 0.69, b: 0.89 },
        { r: 1, g: 1, b: 1 },
      ];

      const color = palette[Math.floor(Math.random() * palette.length)];
      colors[i] = color.r;
      colors[i + 1] = color.g;
      colors[i + 2] = color.b;
    }

    starsGeometry.setAttribute(
      "position",
      new THREE.BufferAttribute(positions, 3),
    );
    starsGeometry.setAttribute("color", new THREE.BufferAttribute(colors, 3));

    const stars = new THREE.Points(starsGeometry, starsMaterial);
    scene.add(stars);

    /* ---------------- CAMERA (SPACESHIP) ---------------- */

    camera.position.z = 500;

    let mouseX = 0;
    let mouseY = 0;

    // NEW: spaceship movement vars
    let targetZ = 500;
    let currentZ = 500;

    const MIN_Z = 120;
    const MAX_Z = 1200;
    const SCROLL_SPEED = 0.6;

    document.addEventListener("mousemove", (event) => {
      mouseX = (event.clientX / window.innerWidth) * 4 - 1;
      mouseY = -(event.clientY / window.innerHeight) * 4 + 1;
    });

    // scroll = thrust forward/back
    window.addEventListener("wheel", (event) => {
      targetZ += event.deltaY * SCROLL_SPEED;
      targetZ = Math.max(MIN_Z, Math.min(MAX_Z, targetZ));
    });

    function animate() {
      requestAnimationFrame(animate);

      // smooth forward motion
      currentZ += (targetZ - currentZ) * 0.05;
      camera.position.z = currentZ;

      // steering
      camera.position.x += (mouseX * 50 - camera.position.x) * 0.05;
      camera.position.y += (mouseY * 50 - camera.position.y) * 0.05;
      camera.lookAt(scene.position);

      // speed illusion (closer = faster stars)
      const speedFactor = (500 - currentZ) * 0.000002;

      stars.rotation.y += 0.0004 + speedFactor;
      stars.rotation.x += 0.00025 + speedFactor * 0.5;

      renderer.render(scene, camera);
    }

    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    animate();
  }
</script>

<style>
  #space-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    background: transparent;
    pointer-events: none;
  }
</style>
